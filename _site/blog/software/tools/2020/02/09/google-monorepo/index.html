<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Google's Monolithic Repo &middot; Min Yang Jung
    
  </title>

  

  <link rel="stylesheet" href="http://minyangjung.com/public/css/poole.css">
  <link rel="stylesheet" href="http://minyangjung.com/public/css/syntax.css">
  <link rel="stylesheet" href="http://minyangjung.com/public/css/lanyon.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css">

  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://minyangjung.com/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="http://minyangjung.com/public/favicon.ico">

  <link rel="alternate" type="application/rss+xml" title="RSS" href="http://minyangjung.com/atom.xml">

  <style>
  .tag {
    font-family: 'Lato', Calibri, 'Helvetica Neue', Helvetica, Arial, sans-serif;
    background-color: #ededed;
    margin-left: 2px;
    padding: 3px 7px;
    font-size: 12px;
    letter-spacing: 1px;
  }
  </style>
  
    






  

  
  
</head>


  <body class="sidebar-overlay">

    






<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<!--<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" checked>-->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div><center>
    <img src='/assets/profile.jpg' style='border-radius: 50%; margin-top: 40px;' width='60%'>
  </center></div>
  <div class="sidebar-item">
    <p><b>Min Yang Jung</b> works in the medical device industry developing products for the da Vinci surgical systems.</p>
  </div>

  <nav class="sidebar-nav">
    <a class="sidebar-nav-item" href="http://minyangjung.com/">Home</a>

    

    
    
      
        
      
    
      
        
      
    
      
        
          <a class="sidebar-nav-item" href="http://minyangjung.com/about/">About Me</a>
        
      
    
      
    
      
        
      
    
      
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="http://minyangjung.com/publications/">Publications</a>
        
      
    
      
    
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    
      
        
      
    

    <!--<a class="sidebar-nav-item" href="/archive/v1.0.0.zip">Download</a>
    <a class="sidebar-nav-item" href="">GitHub project</a>
    <span class="sidebar-nav-item">Currently v1.0.0</span>-->
    <a class="sidebar-nav-item" href="http://minyangjung.com/blog">Blog</a>
  </nav>

  <div class="sidebar-item">
    <p>
      <a href="http://minyangjung.com" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-house-fill" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8 3.293l6 6V13.5a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5V9.293l6-6zm5-.793V6l-2-2V2.5a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5z"/><path fill-rule="evenodd" d="M7.293 1.5a1 1 0 0 1 1.414 0l6.647 6.646a.5.5 0 0 1-.708.708L8 2.207 1.354 8.854a.5.5 0 1 1-.708-.708L7.293 1.5z"/></svg></a>&nbsp;&nbsp;
      <a href="http://github.com/minyang" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-github" viewBox="0 0 16 16"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a>&nbsp;&nbsp;
      <a href="https://www.linkedin.com/in/min-yang-jung-763b5839" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-linkedin" viewBox="0 0 16 16"><path d="M0 1.146C0 .513.526 0 1.175 0h13.65C15.474 0 16 .513 16 1.146v13.708c0 .633-.526 1.146-1.175 1.146H1.175C.526 16 0 15.487 0 14.854V1.146zm4.943 12.248V6.169H2.542v7.225h2.401zm-1.2-8.212c.837 0 1.358-.554 1.358-1.248-.015-.709-.52-1.248-1.342-1.248-.822 0-1.359.54-1.359 1.248 0 .694.521 1.248 1.327 1.248h.016zm4.908 8.212V9.359c0-.216.016-.432.08-.586.173-.431.568-.878 1.232-.878.869 0 1.216.662 1.216 1.634v3.865h2.401V9.25c0-2.22-1.184-3.252-2.764-3.252-1.274 0-1.845.7-2.165 1.193v.025h-.016a5.54 5.54 0 0 1 .016-.025V6.169h-2.4c.03.678 0 7.225 0 7.225h2.4z"/></svg></a>&nbsp;&nbsp;
      <a href="&#109;&#97;&#105;&#108;&#116;&#111;&#58;&#99;&#111;&#110;&#116;&#97;&#99;&#116;&#64;&#109;&#105;&#110;&#121;&#97;&#110;&#103;&#106;&#117;&#110;&#103;&#46;&#99;&#111;&#109;"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-envelope-fill" viewBox="0 0 16 16"><path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558L0 4.697zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"/></svg></a>&nbsp;&nbsp;
      <a href="http://minyangjung.com/feed.xml"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-rss-fill" viewBox="0 0 16 16"><path d="M2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2zm1.5 2.5c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1 0-2zm0 4a6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1 0-2zm.5 7a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"/></svg></a>&nbsp;&nbsp;
    </p>
    <p>&copy; 2021. All rights reserved.</p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">Min Yang Jung</a>
            <small>&nbsp;&nbsp;Software, Safety, and Medical Robotics</small>
          </h3>
        </div>
      </div>

      <div class="container content">
        <div class="post">
  <h1 class="post-title">Google's Monolithic Repo</h1>
  <span class="post-date">Min Yang Jung | 09 Feb 2020</span>
  <ul><li><a href="#references">References</a></li></ul>

  <p>How do you maintain source code of your project?  Of course, you probably use one of
version control software like git, svn, and Perforce.  Those off-the-shelf tools should
work for the most of personal and small/medium-sized projects.  As the scale and
complexity of the projects grow, however, you  may encounter practical issues on a daily
basis in different areas.  For example, git clone may take too much time, back-end CI
infrastructure may be a bottleneck when verifying new change sets (e.g., too slow, too
many false build failures), and developers may start noticing room for improvement in
their development workflow.  These  issues are essentially related to the scalability of
development environments, which can be asked with one simple question: 
<em>does your development environment scale?</em></p>

<p>Not until recently did I ask the question to myself.  For the last project that I worked
on at work, we structured our repos using git submodules to accommodate certain build
scenario requirements.  This submodule-based modular repo structure enabled us to quickly
and independently develop each sub-project while the main project moves forward (I will
write about this experience later on a separate article).  For the current project,
though, it became part of our company’s monolithic source repository, which is shared
among all the engineers within the company.  As someone who was familiar with the
submodule-based multi-repo model, I was curious about the rationale of choosing the
monolithic repo model.  More importantly, I wanted to better understand the benefits and
implications of such a decision on not only in a short term (e.g., on engineers’
day-to-day development workflow) but also in a long(er) term (e.g., what it means to the
company after 10/20+ years).  Essentially, I was asking the question – <em>does it scale?</em></p>

<p>Coincidentally, I came across two interesting articles from Google Research around this topic:</p>

<ul>
  <li>Why Google Stores Billions of Lines of Code in a Single Repository (ACM 2016) [1]</li>
  <li>Advantages and disadvantages of a monolithic repository: a case study at Google (ICSE-SEIP 2018) [2]</li>
</ul>

<p>With an introduction to the Google scale (9 billion source files, 35 million commits, 86TB
of content, ~40k commits/workday as of 2015), the first article describes why Google chose
the monolithic-source-management strategy in 1999, how it has been working for Google,
what in-house tooling and custom infrastructural efforts they have made over the years to
enable streamlined trunk-based development workflows, and advantages and alternatives of
the strategy.  From the first article:</p>

<blockquote>
  <p>… Google has embraced the monolithic model due to its compelling advantages.  Most important, it supports:</p>

  <ul>
    <li>Unified versioning, one source of truth</li>
    <li>Extensive code sharing and reuse</li>
    <li>Simplified dependency management</li>
    <li>Atomic changes</li>
    <li>Large-scale refactoring</li>
    <li>Collaboration across teams</li>
    <li>Flexible team boundaries and code ownership</li>
    <li>Code visibility and clear tree structure providing implicit team namespacing</li>
  </ul>
</blockquote>

<p>The second article is a survey-based case study where hundreds Google engineers were asked
about their experience with the mono-repo vs. multi-repo models and discusses pros and
cons of the mono-repo model.  The five key findings from the article are as follows (from
Sec. 5. Discussion):</p>

<ul>
  <li>The visibility of a monolithic repo is highly impactful.</li>
  <li>Developer tools may be as important as the type of repo.</li>
  <li>There is a tension between consistent style and tool use with freedom and flexibility of the toolchain.</li>
  <li>There is a tension between having all dependencies at the latest version and having versioned dependencies.</li>
  <li>Reducing cognitive load is important, but there are many ways to achieve this.</li>
</ul>

<p>Related to 3rd and 4th points, the paper points out that the multi-repo model brings more
flexibility for engineers to choose their own toolchains, provides more access control,
and enables stability.</p>

<p>Although these two articles articulate the rationale and benefits of the mono-repo based
on Google’s experience, one key take-away for me is that the mono-repo model requires
substantial amount of engineering efforts on creating in-house tooling and custom
infrastructures to streamline the development workflow and activities such as code review,
sample code search, API auto-update, pre-commit CI verify jobs with impact analysis and
assessment, and so forth.  Without such heavy investment on infrastructure and tooling
support, the mono-repo model simply would not work.  Looking at Facebook’s Mercurial
extension [3] and Microsoft’s GVFS [4-7], this seems to be true for other companies that
adopted the mono-repo model but with different approaches/solutions</p>

<h3 id="references">References</h3>

<ul>
  <li>Rachel Potvin and Josh Levenberg, “Why Google Stores Billions of Lines of Code in a
  Single Repository,” Communications of the ACM, July 2016, Vol. 59 No. 7, Pages 78-87
  (DOI: <a href="http://dx.doi.org/10.1145/2854146">10.1145/2854146</a>).</li>
  <li>Jaspan, Ciera, Matthew Jorde, Andrea Knight, Caitlin Sadowski, Edward K. Smith, Collin
  Winter, and Emerson Murphy-Hill, “Advantages and disadvantages of a monolithic
  repository: a case study at Google,” In Proceedings of the 40th International
  Conference on Software Engineering: Software Engineering in Practice, pp. 225-234.
  2018 (DOI: <a href="https://dl.acm.org/doi/abs/10.1145/3183519.3183550">10.1145/3183519.3183550</a>).</li>
  <li>Facebook: Mercurial extension https://engineering.fb.com/core-data/scaling-mercurial-at-facebook (Accessed: February 9, 2020)</li>
  <li>Brian Harry, <a href="https://devblogs.microsoft.com/bharry/scaling-git-and-some-back-story">Scaling Git (February 3,
  2017)</a>:
  <a href="https://vfsforgit.org">GVFS</a> (Accessed: February 9, 2020)</li>
  <li>Brian Harry, <a href="https://devblogs.microsoft.com/bharry/the-largest-git-repo-on-the-planet">The larget Git repo on the
  planet</a> (May 24, 2017) (Accessed: February 9, 2020)</li>
  <li>Brian Harry, <a href="https://devblogs.microsoft.com/bharry/perf-results-on-scaling-git-on-vsts-with-gvfs">Perf results on scaling Git on VSTS with
  GVFS</a> (July 6, 2017) (Accessed: February 9, 2020)</li>
  <li>Saeed Noursalehi,
  <a href="https://docs.microsoft.com/en-us/azure/devops/learn/git/git-at-scale">https://docs.microsoft.com/en-us/azure/devops/learn/git/git-at-scale</a> (Accessed: February 9, 2020)</li>
</ul>

  <div style="text-align:right; width:100%">
    <!--<span class="post-date" style="float:left">09 Feb 2020</span>-->
    
      <i class="bi bi-tags"></i>
      
        
        <a href="/tag/software"><span class="tag">SOFTWARE</span></a>
      
        
        <a href="/tag/development"><span class="tag">DEVELOPMENT</span></a>
      
    
  </div>
</div>


<div class="related">
  <h2>Related posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="/blog/software/bash/2021/01/18/bash-tips/">
            Bash Tips and Code Examples
            <small>18 Jan 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/software/tools/2021/01/10/vim-tip-working-with-binary-files/">
            Working with Binary Files
            <small>10 Jan 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/management/2020/08/21/makers-schedule-managers-schedule/">
            Maker's Schedule, Manager's Schedule
            <small>21 Aug 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>


      </div>
    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script src='/public/js/script.js'></script>
  </body>
</html>
